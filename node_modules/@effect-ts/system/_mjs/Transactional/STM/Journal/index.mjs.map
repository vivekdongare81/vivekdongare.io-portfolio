{"version":3,"file":"index.mjs","mappings":"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","names":["HM","T","defaultScheduler","STMDriver","DieTypeId","FailTypeId","RetryTypeId","SucceedTypeId","Done","DoneTypeId","Suspend","SuspendTypeId","prepareResetJournal","journal","saved","Map","entry","set","use","_","copy","clear","commitJournal","commit","analyzeJournal","val","isInvalid","isChanged","emptyTodoMap","make","collectTodos","allTodos","tref","todos","todo","get","execTodos","completeTodos","io","size","addTodo","txnId","todoEffect","added","oldTodo","has_","newTodo","set_","untrackedTodoTargets","oldJournal","newJournal","untracked","key","value","has","isNew","tryCommit","fiberId","stm","r","run","analysis","Error","_typeId","succeed","fail","die","completeTryCommit","k","done","suspendTryCommit","accum","tryCommitAsync","undefined","v","isValid","valid"],"sourceRoot":"","sources":["../../../../_src/Transactional/STM/Journal/index.ts"],"sourcesContent":[null]}